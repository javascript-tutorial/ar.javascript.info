
#  الكائن العام  Global object 
الكائن العام يخدم المتغيرات والدوال المتاحة في أي مكان في الكود. مبدئيًا، المتغيرات والدوال مبنيان داخل اللغة أو بيئة العمل.


داخل المتصفح تسمى `window`، أما بخصوص الــ Node.js فهي تسمى `global`، ولأي بيئة أخرى فربما تحمل أسم أخر. 

مؤخرًا، تم إضافة `globalThis` للغة البرمجة كمعيار أسمي للكائن العام الذي يجب أن يُدعم خلال كل البيئات. في بعض المتصفحات، تحديدًا المتصفحات غير الكروميوم، `globalThis` ليست مدعمة بعد فيهم، لكن يمكن تطبيقه بسهوله داخل المتصفح.

سوف نستخدم `window` هنا، افتراضًا أن بيئتنا هي المتصفح. لو استخدمت السكريبت في أي بيئة أخرى، فالأفضل لك استخدام `globalThis` بدلًا من `window`. 

كل صفات الكائن العام نستطيع استرجعها مباشرة:

```js run
alert("أهلًا");
// مطابق لـ
window.alert("أهلًا");
```

في المتصفح، الدوال العامة والمتغيرات تُعرف بـ `var` (ليس بـ `let/const`) لتصبح الخاصية للكائن العام:

```js run untrusted refresh
var gVar = 5;

alert(window.gVar); // 5 (تصبح خاصية للكائن العام)
```

لا تعتمد على ذلك! هذه الطريقة وُجدت لدواعي التنسيق. السكريبتات الحديثة تستخدم [JavaScript modules](info:modules).

لو تم استخدام `let`، تلك الخاصية لن تُعرّف.


```js run untrusted refresh
let gLet = 5;

alert(window.gLet); // undefined (لا تصبح خاصية للكائن العام)
```

لو أصبحت القيمة أو المُخرج مهم جدًا وتفضل جعله عام ليكون متاحًا للاستخدام بعد ذلك، أكتبه مباشرة كخاصية: 

```js run
*!*

// جعل معلومات المستخدم الحالي عامة لكي يتسمى لكل السكريبتات باستخدامها
window.currentUser = {
  name: "John"
};
*/!*

// في مكان أخر في الكود
alert(currentUser.name);  // John

// أو لو كان لدينا متغير داخلي باسم "currentUser" 
// نحصل عليه من شاشة منفصلة (أأمن!)
alert(window.currentUser.name); // John
```

يمكننا أن نستنتج أن استخدام المتغيرات العامة عمومَا غير محبذ به. يجب أن تقل المتغيرات العامة بقدر الإمكان. تصميم الكود حيث جعل الدوال تستخدم متغيرات داخلية (خاصة) لتخرج نتائج محددة، أفضل وأقل عرضة للأخطاء وأسهل للاختبار، من استخدام متغيرات خارجية وعامة.

## استخدام للبولي فيلز Using for polyfills

لو كان لا يوجد (افترض أننا في متصفح قديم)، يمكننا كتابة كود (بولي فيلز) لتعريف الدوال التي لا تدعم بالبيئات، لكنها توجد في المعاير الحديثة.
```js run
if (!window.Promise) {
  alert("المتصفح لديك قديم!");
}
```


لو كان لا يوجد (افترض أننا في متصفح قديم)، يمكننا كتابة كود لتعريف الدوال التي لا تدعم بالبيئات، لكنها توجد في المعاير الحديثة.


```js run
if (!window.Promise) {
  window.Promise = ... // إدخال خواص لغة البرمجة الحديثة
}
```

## الملخص Summary

- 	الكائن العام يحمل المتغيرات التي يجب أن تكون متاحة في أي مكان.
ذلك يتضمن مدموجات الجافا سكريبت، مثل `Array` وقيم البيئة الخاصة، مثل `window.innerHeight` -- ارتفاع الشاشة داخل المتصفح.
-	الكائن العام يحمل أسم عمومي `globalThis`.
لكن في بعض الأحيان يُشار إليه بأسامي "تقليدية" للبيئة الخاصة، مثل `window` (المتصفح) و `global` (Node.js). بينما `globalThis` كمشروع جديد، فهو لا يُدعم بمتصفحات غير الكروميوم (لكن يمكن تعريفه).
-	يجب تخزين القيم في كائنات عامة فقط في حالة أنهم قيم عامة للمشروع. ويجب تقليل عددهم.
-	في المتصفحات، مالم نستخدم [modules](info:modules)، فإن الدوال عامة والمتغيرات تُعرف ب`var`، وتصبح خاصية للكائن العام.
-	لجعل الكود برهان مستقبلي وأسهل للفهم، فإنه يجب إدخال خواص الكائن العام مباشرة، كـ`window.x`.

